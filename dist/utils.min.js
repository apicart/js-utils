/** 
 * utils.js v1.0.0-alpha1 
 * (c) 2018-2019 Vladimír Macháček
 *  Released under the MIT License.
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var c={forEach:function(e,t){var n,r,a,o,i,s={iterableLength:0,counter:0,isEven:function(){return this.counter%2==0},isOdd:function(){return 1===Math.abs(this.counter%2)},isFirst:function(){return 1===this.counter},isLast:function(){return this.counter===r}};if(!(-1<["undefined","number"].indexOf(typeof e)||null===e)){if(Array.isArray(e)){if(!(r=Object.keys(e).length))return;for(s.iterableLength=r,n=0;n<r&&(s.counter++,!1!==t.apply(s,[n,e[n]]));n++);}else{if(o=(a=Object.keys(e)).length,!a.length)return;for(s.iterableLength=o,n=0;n<o&&(s.counter++,i=a[n],!1!==t.apply(s,[i,e[i]]));n++);}return c}}};var o={firstToUpper:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateHash:function(e,t){var n="";for(t=t||"abcdefghijklmnopqrstuvwxyz0123456789";e--;)n+=t.charAt(Math.floor(Math.random()*t.length));return n},sprintf:function(n,e){return c.forEach(e,function(e,t){-1!==["number","string"].indexOf(typeof t)&&(n=n.replace(new RegExp("%"+e+"%","g"),t))}),n}};function n(e){var t=typeof e;return"undefined"===t||null===e||"number"!==t&&("string"===t?0===e.length:"object"===t||Array.isArray(e)?Object.keys(e).length<1:void 0)}var i={isEmpty:n};function t(n,e){return"string"==typeof e&&(e=e.split(".")),1<e.length&&c.forEach(e,function(e,t){if("object"!=typeof n[t])return!1;n=n[t]}),delete n[e.pop()],s}var s={assign:function(e,t,n){"string"==typeof t&&(t=t.split("."));for(var r,a=t.length-1,o=0;o<a;++o)(r=t[o])in e||(e[r]={}),e=e[r];return e[t[a]]=n,s},copy:function(e){var n={};return c.forEach(e,function(e,t){n[e]=s.isObject(t)?s.copy(t):t}),n},delete:t,find:function(n,e){if(!e||!n||"object"!=typeof n)return null;"string"==typeof e&&(e=e.split("."));var r=!1;return 1<e.length&&c.forEach(e,function(e,t){return"object"==typeof n&&t in n?"object"==typeof n[t]&&void(n=n[t]):!(r=!0)}),r?null:n[e.pop()]},isObject:function(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e},merge:function(){var n={},e=Array.prototype.slice.call(arguments);return c.forEach(e,function(e,t){c.forEach(t,function(e,t){n[e]=e in n&&s.isObject(t)?s.merge(n[e],t):t})}),n},values:function(e){var n=[];return c.forEach(e,function(e,t){n.push(t)}),n}};function e(e){return u.isJson(e)?JSON.parse(e):{}}function r(e){return"object"==typeof e?JSON.stringify(e):""}var u={isJson:function(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0},parse:e,stringify:r};var f={error:function(){return void 0!==console.error&&console.error.apply(null,Array.prototype.slice.call(arguments)),f},log:function(){return void 0!==console.log&&console.log.apply(null,Array.prototype.slice.call(arguments)),f},warn:function(){return void 0!==console.warn&&console.warn.apply(null,Array.prototype.slice.call(arguments)),f}};var a=Element.prototype;var l={addClass:function(n,e){return"string"==typeof e&&(e=e.split(" ")),c.forEach(e,function(e,t){n.classList.contains(t)||(n.className+=" "+t)}),n.className=n.className.trim(),l},findParent:function(e,t){for(var n=null;e=e.parentElement;)if(l.matches(e,t)){n=e;break}return n},matches:function(e,t){return a.matches?e.matches(t):!!a.msMatchesSelector&&e.msMatchesSelector(t)},on:function(t,e,o){return"string"==typeof t&&(t=t.split(" ")),"string"==typeof e&&(e=e.split(",")),c.forEach(e,function(e,a){c.forEach(t,function(e,t){var n,r;n=a,r=t,document.addEventListener(r,function(e){var t=e.target;if(t!==document){for(;t&&t!==this&&!l.matches(t,n);)t=t.parentNode;t&&t!==this&&(e.preventDefault(),o.call(t,e))}})})}),l},removeClass:function(e,t){return t=t.replace(" ","|"),e.className=e.className.replace(new RegExp(t,"g"),"").trim(),e.className=e.className.replace(/\s+/," "),l},trigger:function(e,r){return e instanceof Element&&(e=[e]),c.forEach(e,function(e,t){var n=new Event(r,{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(n)}),l}};function p(e,t){return s.assign(A,e,t),localStorage.setItem(y,u.stringify(A)),M}function d(e){e=e||!1;var t=document.querySelectorAll(e?m:m+":not(["+v+"])");return c.forEach(t,function(e,t){var n=t.getAttribute(g);if(n){var r=s.find(A,n);if(r){var a=t.getAttribute(g+"-if"),o=t.tagName.toLowerCase();if(-1<h.indexOf(o)){if(a===E&&t.value)return;"input"===o&&"radio"===t.getAttribute("type")&&t.getAttribute("name")?document.querySelector('[name="'+t.getAttribute("name")+'"][value="'+r+'"]').checked=!0:t.value=r}else{if(a===E&&t.innerHTML.trim())return;t.innerHTML=r}t.setAttribute(v,!0)}}}),M}l.on("change",m,function(){p(this.getAttribute(g),this.value)}),document.addEventListener("DOMContentLoaded",function(){d()});var g="data-bind",h=["select","input"],y="apicart_data_binder_data",m="["+g+"]",v="data-bound",E="empty",b=localStorage.getItem(y),A=b?e(b):{},M={addData:p,bindData:d,removeData:function(e){return e&&t(A,e),localStorage.setItem(y,r(A)),M}};var j={},w={addListener:function(n,e,r,a){return a=a||!1,"string"==typeof e&&(e=e.split(" ")),c.forEach(e,function(e,t){t in j||(j[t]={}),j[t][n]={callback:r,singleAction:a}}),w},dispatchEvent:function(e,r){return Array.isArray(r)||(r=[r]),"string"==typeof e&&(e=e.split(" ")),c.forEach(e,function(e,n){n in j&&c.forEach(j[n],function(e,t){t.singleAction&&w.removeListener(e,n),t.callback.apply(null,r)})}),w},removeListener:function(n,e){return"string"==typeof e&&(e=e.split(" ")),c.forEach(e,function(e,t){delete j[t][n]}),w}};var L="apicart_flash_messages",O={addMessage:function(e,t){t=t||"info";var n=O.getMessages();return t in n||(n[t]=[]),n[t].push(e),localStorage.setItem(L,u.stringify(n)),O},getMessages:function(){var e=localStorage.getItem(L);return e=e?u.parse(e):{}},hasMessages:function(e){var t=O.getMessages();return e?!n(t[e]):!n(t)},processMessages:function(r,n){var e;return"string"==typeof n&&O.hasMessages(n)?(e=O.getMessages(),c.forEach(e[n],function(e,t){r(t,n)})):O.hasMessages()&&(e=O.getMessages(),c.forEach(e,function(n,e){i.isEmpty(e)||c.forEach(e,function(e,t){r(t,n)})})),localStorage.setItem(L,u.stringify({})),O}};var S={getQueryParameter:function(e,t){t=t||window.location.href,e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}};window["undefined"==typeof utilsAlias?"Utils":utilsAlias]={ajax:function(e){var n={async:!0,cache:!0,queryParameters:{},data:{},headers:{},method:"get",timeout:5e3,url:"",withCredentials:!1,start:function(){},complete:function(){}};if(c.forEach(e,function(e,t){n[e]=t}),i.isEmpty(n.url))f.warn("@apicart/js-utils: No url provided for ajax request:",n);else{var t=-1<n.url.indexOf("?");if(n.cache||(n.queryParameters.h=o.generateHash(10)),"get"===n.method&&(n.queryParameters=s.merge(n.queryParameters,n.data),n.data={}),!i.isEmpty(n.queryParameters)){t||(n.url+="?");var r=!0;c.forEach(n.queryParameters,function(e,t){r||(n.url+="&"),n.url+=e+"="+encodeURIComponent(t),r=!1})}var a=new XMLHttpRequest;a.open(n.method,n.url,n.async),n.async&&0<n.timeout&&(a.timeout=n.timeout),i.isEmpty(n.headers)||c.forEach(n.headers,function(e,t){a.setRequestHeader(e,t)}),a.onreadystatechange=function(){var e=a.responseText;u.isJson(e)&&(e=u.parse(e));var t={config:n,data:e,headers:a.headers,request:a,status:a.status,statusText:a.statusText};2===a.readyState?n.start(t):4===a.readyState&&n.complete(t)},"string"!=typeof n.data&&(n.data=u.stringify(n.data)),i.isEmpty(n.data)&&(n.data=null),a.send(n.data)}},console:f,dataBinder:M,dom:l,eventDispatcher:w,flashMessages:O,json:u,loops:c,objects:s,strings:o,url:S,validators:i}});
