/** 
 * utils.js v1.0.0-alpha1 
 * (c) 2018-2019 Vladimír Macháček
 *  Released under the MIT License.
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var s={forEach:function(e,t){var r,n,a,o,i;if(!(-1<["undefined","number"].indexOf(typeof e)||null===e)){if(Array.isArray(e)){if(!(n=e.length))return;for(r=0;r<n&&!1!==t(r,e[r]);r++);}else{if(!(o=(a=Object.keys(e)).length))return;for(r=0;r<o&&!1!==t(i=a[r],e[i]);r++);}return s}}};var o={firstToUpper:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateHash:function(e,t){var r="";for(t=t||"abcdefghijklmnopqrstuvwxyz0123456789";e--;)r+=t.charAt(Math.floor(Math.random()*t.length));return r},sprintf:function(r,e){return s.forEach(e,function(e,t){-1!==["number","string"].indexOf(typeof t)&&(r=r.replace(new RegExp("%"+e+"%","g"),t))}),r}};function r(e){var t=typeof e;return"undefined"===t||null===e||"number"!==t&&("string"===t?0===e.length:"object"===t||Array.isArray(e)?Object.keys(e).length<1:void 0)}var i={isEmpty:r};function t(r,e){return"string"==typeof e&&(e=e.split(".")),1<e.length&&s.forEach(e,function(e,t){if("object"!=typeof r[t])return!1;r=r[t]}),delete r[e.pop()],c}var c={assign:function(e,t,r){"string"==typeof t&&(t=t.split("."));for(var n,a=t.length-1,o=0;o<a;++o)(n=t[o])in e||(e[n]={}),e=e[n];return e[t[a]]=r,c},copy:function(e){var r={};return s.forEach(e,function(e,t){r[e]=c.isObject(t)?c.copy(t):t}),r},delete:t,find:function(r,e){if(!e||!r||"object"!=typeof r)return null;"string"==typeof e&&(e=e.split("."));var n=!1;return 1<e.length&&s.forEach(e,function(e,t){return"object"==typeof r&&t in r?"object"==typeof r[t]&&void(r=r[t]):!(n=!0)}),n?null:r[e.pop()]},isObject:function(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e},merge:function(){var r={},e=Array.prototype.slice.call(arguments);return s.forEach(e,function(e,t){s.forEach(t,function(e,t){r[e]=e in r&&c.isObject(t)?c.merge(r[e],t):t})}),r},values:function(e){var r=[];return s.forEach(e,function(e,t){r.push(t)}),r}};function e(e){return u.isJson(e)?JSON.parse(e):{}}function n(e){return"object"==typeof e?JSON.stringify(e):""}var u={isJson:function(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0},parse:e,stringify:n};var f={error:function(){return void 0!==console.error&&console.error.apply(null,Array.prototype.slice.call(arguments)),f},log:function(){return void 0!==console.log&&console.log.apply(null,Array.prototype.slice.call(arguments)),f},warn:function(){return void 0!==console.warn&&console.warn.apply(null,Array.prototype.slice.call(arguments)),f}};var a=Element.prototype;var l={addClass:function(r,e){return"string"==typeof e&&(e=e.split(" ")),s.forEach(e,function(e,t){r.classList.contains(t)||(r.className+=" "+t)}),r.className=r.className.trim(),l},findParent:function(e,t){for(var r=null;e=e.parentElement;)if(l.matches(e,t)){r=e;break}return r},matches:function(e,t){return a.matches?e.matches(t):!!a.msMatchesSelector&&e.msMatchesSelector(t)},on:function(t,e,o){return"string"==typeof t&&(t=t.split(" ")),"string"==typeof e&&(e=e.split(",")),s.forEach(e,function(e,a){s.forEach(t,function(e,t){var r,n;r=a,n=t,document.addEventListener(n,function(e){var t=e.target;if(t!==document){for(;t&&t!==this&&!l.matches(t,r);)t=t.parentNode;t&&t!==this&&(e.preventDefault(),o.call(t,e))}})})}),l},removeClass:function(e,t){return t=t.replace(" ","|"),e.className=e.className.replace(new RegExp(t,"g"),"").trim(),e.className=e.className.replace(/\s+/," "),l},trigger:function(e,n){return e instanceof Element&&(e=[e]),s.forEach(e,function(e,t){var r=new Event(n,{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(r)}),l}};function p(e,t){return c.assign(A,e,t),localStorage.setItem(h,u.stringify(A)),w}function d(e){e=e||!1;var t=document.querySelectorAll(e?m:m+":not(["+v+"])");return s.forEach(t,function(e,t){var r=t.getAttribute(g);if(r){var n=c.find(A,r);if(n){var a=t.getAttribute(g+"-if"),o=t.tagName.toLowerCase();if(-1<y.indexOf(o)){if(a===E&&t.value)return;"input"===o&&"radio"===t.getAttribute("type")&&t.getAttribute("name")?document.querySelector('[name="'+t.getAttribute("name")+'"][value="'+n+'"]').checked=!0:t.value=n}else{if(a===E&&t.innerHTML.trim())return;t.innerHTML=n}t.setAttribute(v,!0)}}}),w}l.on("change",m,function(){p(this.getAttribute(g),this.value)}),document.addEventListener("DOMContentLoaded",function(){d()});var g="data-bind",y=["select","input"],h="apicart_data_binder_data",m="["+g+"]",v="data-bound",E="empty",b=localStorage.getItem(h),A=b?e(b):{},w={addData:p,bindData:d,removeData:function(e){return e&&t(A,e),localStorage.setItem(h,n(A)),w}};var M={},j={addListener:function(r,e,n,a){return a=a||!1,"string"==typeof e&&(e=e.split(" ")),s.forEach(e,function(e,t){t in M||(M[t]={}),M[t][r]={callback:n,singleAction:a}}),j},dispatchEvent:function(e,n){return Array.isArray(n)||(n=[n]),"string"==typeof e&&(e=e.split(" ")),s.forEach(e,function(e,r){r in M&&s.forEach(M[r],function(e,t){t.singleAction&&j.removeListener(e,r),t.callback.apply(null,n)})}),j},removeListener:function(r,e){return"string"==typeof e&&(e=e.split(" ")),s.forEach(e,function(e,t){delete M[t][r]}),j}};var S="apicart_flash_messages",x={addMessage:function(e,t){t=t||"info";var r=x.getMessages();return t in r||(r[t]=[]),r[t].push(e),localStorage.setItem(S,u.stringify(r)),x},getMessages:function(){var e=localStorage.getItem(S);return e=e?u.parse(e):{}},hasMessages:function(e){var t=x.getMessages();return e?!r(t[e]):!r(t)},processMessages:function(n,r){var e;return"string"==typeof r&&x.hasMessages(r)?(e=x.getMessages(),s.forEach(e[r],function(e,t){n(t,r)})):x.hasMessages()&&(e=x.getMessages(),s.forEach(e,function(r,e){i.isEmpty(e)||s.forEach(e,function(e,t){n(t,r)})})),localStorage.setItem(S,u.stringify({})),x}};var q={getQueryParameter:function(e,t){t=t||window.location.href,e=e.replace(/[[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}};window["undefined"==typeof utilsAlias?"Utils":utilsAlias]={ajax:function(e){var r={async:!0,cache:!0,queryParameters:{},data:{},headers:{},method:"get",timeout:5e3,url:"",withCredentials:!1,start:function(){},complete:function(){}};if(s.forEach(e,function(e,t){r[e]=t}),i.isEmpty(r.url))f.warn("@apicart/js-utils: No url provided for ajax request:",r);else{var t=-1<r.url.indexOf("?");if(r.cache||(r.queryParameters.h=o.generateHash(10)),"get"===r.method&&(r.queryParameters=c.merge(r.queryParameters,r.data),r.data={}),!i.isEmpty(r.queryParameters)){t||(r.url+="?");var n=!0;s.forEach(r.queryParameters,function(e,t){n||(r.url+="&"),r.url+=e+"="+encodeURIComponent(t),n=!1})}var a=new XMLHttpRequest;a.open(r.method,r.url,r.async),r.async&&0<r.timeout&&(a.timeout=r.timeout),i.isEmpty(r.headers)||s.forEach(r.headers,function(e,t){a.setRequestHeader(e,t)}),a.onreadystatechange=function(){var e=a.responseText;u.isJson(e)&&(e=u.parse(e));var t={config:r,data:e,headers:a.headers,request:a,status:a.status,statusText:a.statusText};2===a.readyState?r.start(t):4===a.readyState&&r.complete(t)},"string"!=typeof r.data&&(r.data=u.stringify(r.data)),i.isEmpty(r.data)&&(r.data=null),a.send(r.data)}},console:f,dataBinder:w,dom:l,eventDispatcher:j,flashMessages:x,json:u,loops:s,objects:c,strings:o,url:q,validators:i}});
